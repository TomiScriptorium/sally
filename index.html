<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sally - Buscador para Preguntas Tontas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap');

        body {
            font-family: 'Nunito', sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }

        /* Animaciones de la Oveja */
        .sheep-container {
            position: relative;
            width: 200px;
            height: 200px;
            margin: 0 auto;
            transition: transform 0.3s ease;
        }

        .sheep-container:hover {
            transform: scale(1.05);
        }

        .wool {
            fill: #FFFFFF;
            stroke: #e5e7eb;
            stroke-width: 2;
            transition: fill 0.3s;
        }
        
        .dark .wool {
            stroke: #374151;
        }

        .face, .legs, .ears {
            fill: #111827;
        }

        .eye {
            fill: white;
        }
        
        .pupil {
            fill: black;
            animation: blink 4s infinite;
        }

        @keyframes blink {
            0%, 96% { transform: scaleY(1); }
            98% { transform: scaleY(0.1); }
            100% { transform: scaleY(1); }
        }

        .mouth {
            fill: none;
            stroke: white;
            stroke-width: 2;
            stroke-linecap: round;
        }

        /* Estados de √Ånimo */
        .thinking .sheep-container {
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* Accesorios por Nivel (Ocultos por defecto) */
        .accessory { display: none; }
        
        .lvl-2 .acc-glasses { display: block; } /* Curioso */
        .lvl-4 .acc-tie { display: block; }     /* Elegante */
        .lvl-7 .acc-cape { display: block; }    /* Heroico */
        .lvl-10 .acc-crown { display: block; }  /* Rey */

        /* Markdown Styles */
        .prose p { margin-bottom: 0.8em; }
        .prose strong { font-weight: 700; color: inherit; }
        .prose ul { list-style-type: disc; padding-left: 1.5em; margin-bottom: 0.8em; }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .dark ::-webkit-scrollbar-thumb { background: #4b5563; }
    </style>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        sally: {
                            light: '#f3f4f6',
                            dark: '#1f2937',
                            accent: '#8b5cf6'
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-sally-light text-gray-800 dark:bg-gray-900 dark:text-gray-100 flex flex-col min-h-screen">

    <!-- Header Minimalista -->
    <header class="p-4 flex justify-between items-center w-full max-w-4xl mx-auto">
        <div class="flex items-center gap-2">
            <h1 class="text-2xl font-black tracking-tight text-sally-accent">Sally.</h1>
            <span class="text-xs px-2 py-1 bg-gray-200 dark:bg-gray-700 rounded-full">v1.0</span>
        </div>
        <div class="flex items-center gap-4">
            <!-- Nivel Badge -->
            <div class="flex flex-col items-end cursor-pointer group" onclick="toggleAchievements()">
                <div class="text-sm font-bold text-sally-accent">Nivel <span id="level-display">1</span></div>
                <div class="w-24 h-2 bg-gray-200 dark:bg-gray-700 rounded-full mt-1 overflow-hidden relative">
                    <div id="xp-bar" class="h-full bg-sally-accent transition-all duration-500" style="width: 0%"></div>
                </div>
                <!-- Tooltip b√°sico -->
                <div class="absolute mt-8 hidden group-hover:block bg-black text-white text-xs p-2 rounded z-10">
                    Ver logros
                </div>
            </div>

            <!-- Dark Mode Toggle -->
            <button onclick="toggleTheme()" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-800 transition">
                <i class="fas fa-moon dark:hidden text-gray-600"></i>
                <i class="fas fa-sun hidden dark:block text-yellow-400"></i>
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow flex flex-col items-center justify-center p-4 w-full max-w-2xl mx-auto relative">
        
        <!-- Mascota Sally ELIMINADA -->

        <!-- Input Area -->
        <div class="w-full relative z-10">
            <div class="relative group">
                <input type="text" id="user-input" 
                    placeholder="Pregunta lo que sea (no juzgo)..." 
                    class="w-full p-6 pl-8 text-lg rounded-3xl border-2 border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 shadow-lg focus:outline-none focus:border-sally-accent focus:ring-4 focus:ring-purple-100 dark:focus:ring-purple-900 transition-all text-center"
                    onkeypress="handleEnter(event)">
                <button onclick="askSally()" 
                    class="absolute right-3 top-3 bottom-3 bg-sally-accent hover:bg-purple-600 text-white p-4 rounded-2xl transition-all shadow-md">
                    <i class="fas fa-arrow-right"></i>
                </button>
            </div>
            <p class="text-center text-xs text-gray-400 mt-4">
                <i class="fas fa-shield-alt mr-1"></i> Modo Inc√≥gnito: No guardo tu historial de b√∫squeda.
            </p>
        </div>

        <!-- Response Area -->
        <div id="response-area" class="w-full mt-8 hidden opacity-0 transition-opacity duration-500">
            <div class="bg-white dark:bg-gray-800 p-8 rounded-3xl shadow-xl border border-gray-100 dark:border-gray-700">
                <div class="prose dark:prose-invert max-w-none text-lg leading-relaxed" id="response-text">
                    <!-- Text goes here -->
                </div>
                <div class="mt-4 flex justify-end">
                    <button onclick="copyResponse()" class="text-xs text-gray-400 hover:text-sally-accent transition">
                        <i class="fas fa-copy mr-1"></i> Copiar
                    </button>
                </div>
            </div>
        </div>

    </main>

    <!-- Logros Modal (Hidden by default) -->
    <div id="achievements-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm" onclick="closeAchievements(event)">
        <div class="bg-white dark:bg-gray-800 w-full max-w-md rounded-3xl shadow-2xl overflow-hidden transform scale-95 transition-transform" id="modal-content">
            <div class="p-6 bg-sally-accent text-white">
                <h2 class="text-2xl font-bold">Tus Logros</h2>
                <p class="text-purple-200 text-sm">Sube de nivel preguntando cosas.</p>
            </div>
            <div class="p-6 max-h-[60vh] overflow-y-auto" id="achievements-list">
                <!-- JS will populate this -->
            </div>
            <div class="p-4 bg-gray-50 dark:bg-gray-900 text-center border-t dark:border-gray-700">
                <button onclick="toggleAchievements()" class="text-sally-accent font-bold hover:underline">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="toast" class="fixed top-20 left-1/2 transform -translate-x-1/2 bg-yellow-400 text-yellow-900 px-6 py-3 rounded-full shadow-xl font-bold translate-y-[-150%] transition-transform duration-500 z-50 flex items-center gap-2">
        <i class="fas fa-star"></i> <span id="toast-message">¬°Nivel Subido!</span>
    </div>

    <script>
        // --- CONFIG ---
        const apiKey = ""; // La API Key se inyectar√° autom√°ticamente
        
        // --- STATE ---
        let gameState = {
            xp: 0,
            level: 1,
            questionsAsked: 0
        };

        const LEVEL_THRESHOLDS = [0, 100, 250, 450, 700, 1000, 1350, 1750, 2200, 2700, 3500];
        
        const ACHIEVEMENTS = [
            { level: 1, title: "Novato", desc: "Acabas de llegar al reba√±o." },
            { level: 2, title: "Curioso", desc: "Empiezas a ver el mundo con gafas nuevas." },
            { level: 3, title: "Pregunt√≥n", desc: "No hay pregunta peque√±a." },
            { level: 4, title: "Fil√≥sofo de Ba√±o", desc: "Te pones elegante para pensar." },
            { level: 5, title: "Erudito Tonto", desc: "Sabes cosas que nadie necesita saber." },
            { level: 6, title: "Maestro del ¬øPor qu√©?", desc: "Cuestionas la realidad misma." },
            { level: 7, title: "H√©roe de la Duda", desc: "Tu capa ondea con el viento del saber." },
            { level: 8, title: "Genio Incomprendido", desc: "Tus preguntas asustan." },
            { level: 9, title: "Or√°culo Lanudo", desc: "Ves m√°s all√° de la hierba." },
            { level: 10, title: "Trascendental", desc: "Eres el Rey/Reina del reba√±o." }
        ];

        // --- INIT ---
        window.onload = function() {
            loadState();
            renderUI();
            
            // Check system preference for theme
            if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
            }
        };

        // --- LOGIC ---

        function handleEnter(e) {
            if (e.key === 'Enter') askSally();
        }

        async function askSally() {
            const input = document.getElementById('user-input');
            const question = input.value.trim();
            const responseArea = document.getElementById('response-area');
            const responseText = document.getElementById('response-text');
            // Referencia a sally-wrapper eliminada

            if (!question) return;

            // UI: Loading State
            input.disabled = true;
            responseArea.classList.add('hidden');
            responseArea.classList.remove('opacity-100');

            try {
                // Generar prompt para Gemini
                const systemPrompt = `Eres Sally, una IA amigable, divertida y sin prejuicios. Est√°s en un buscador dise√±ado para "preguntas tontas". 
                Tu objetivo es responder cualquier pregunta, por muy b√°sica, obvia o absurda que sea, con total seriedad pero con un tono c√°lido, sencillo y a veces con humor ligero.
                Nunca juzgues la pregunta. Si es una pregunta de ortograf√≠a o definici√≥n, s√© directa. 
                Si es una pregunta existencial absurda, s√≠guele el juego.
                Mant√©n las respuestas concisas (m√°ximo 3 p√°rrafos cortos). Usa formato Markdown simple (negritas, listas).
                El usuario acaba de preguntar: "${question}"`;

                // Llamada a API (Mock logic wrapper for actual fetch)
                const text = await fetchGemini(question, systemPrompt);

                // UI: Success
                responseText.innerHTML = marked(text); // Simple parsing logic below
                responseArea.classList.remove('hidden');
                // Small timeout for fade in
                setTimeout(() => responseArea.classList.add('opacity-100'), 50);

                // Game Logic
                addXP(15 + Math.floor(Math.random() * 10)); // 15-25 XP per question

            } catch (error) {
                responseText.innerHTML = "<p>Beeeee... (Hubo un error al conectar con mi cerebro de nube. Intenta de nuevo).</p>";
                responseArea.classList.remove('hidden');
                setTimeout(() => responseArea.classList.add('opacity-100'), 50);
                console.error(error);
            } finally {
                input.disabled = false;
                input.value = '';
                input.focus();
            }
        }

        async function fetchGemini(userQuery, systemPrompt) {
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: userQuery }] }],
                        systemInstruction: { parts: [{ text: systemPrompt }] }
                    })
                });

                if (!response.ok) throw new Error('API Error');
                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
            } catch (e) {
                // Fallback simulation for demo if API fails/key missing
                if(apiKey === "") return "Necesitas configurar la API Key para que funcione de verdad. Pero te responder√© esto: **Beeee**. (Esa es la respuesta oveja para todo).";
                throw e;
            }
        }

        // --- GAMIFICATION ---

        function addXP(amount) {
            const oldLevel = gameState.level;
            gameState.xp += amount;
            gameState.questionsAsked++;
            
            // Calc Level
            let newLevel = 1;
            for (let i = 0; i < LEVEL_THRESHOLDS.length; i++) {
                if (gameState.xp >= LEVEL_THRESHOLDS[i]) {
                    newLevel = i + 1;
                }
            }

            // Cap at 10
            if (newLevel > 10) newLevel = 10;
            
            gameState.level = newLevel;
            saveState();
            renderUI();

            if (newLevel > oldLevel) {
                showToast(`¬°Subiste al Nivel ${newLevel}!`);
                triggerConfetti();
            }
        }

        function saveState() {
            localStorage.setItem('sally_gameState', JSON.stringify(gameState));
        }

        function loadState() {
            const saved = localStorage.getItem('sally_gameState');
            if (saved) {
                gameState = JSON.parse(saved);
            }
        }

        function renderUI() {
            // Update Level Badge
            document.getElementById('level-display').innerText = gameState.level;
            
            // Update XP Bar
            const currentThreshold = LEVEL_THRESHOLDS[gameState.level - 1];
            const nextThreshold = LEVEL_THRESHOLDS[gameState.level] || (currentThreshold + 500); // Fallback for max level
            const progress = ((gameState.xp - currentThreshold) / (nextThreshold - currentThreshold)) * 100;
            document.getElementById('xp-bar').style.width = `${Math.min(100, Math.max(0, progress))}%`;

            // Actualizaci√≥n visual de la oveja ELIMINADA
            
            // Render Achievements List
            const list = document.getElementById('achievements-list');
            list.innerHTML = ACHIEVEMENTS.map(ach => {
                const unlocked = gameState.level >= ach.level;
                return `
                    <div class="flex items-center gap-4 mb-4 p-3 rounded-xl ${unlocked ? 'bg-purple-50 dark:bg-purple-900/20 border border-purple-200 dark:border-purple-800' : 'bg-gray-100 dark:bg-gray-700 opacity-50'}">
                        <div class="w-10 h-10 rounded-full flex items-center justify-center ${unlocked ? 'bg-sally-accent text-white' : 'bg-gray-300 text-gray-500'} font-bold">
                            ${ach.level}
                        </div>
                        <div>
                            <h4 class="font-bold ${unlocked ? 'text-gray-800 dark:text-white' : 'text-gray-500'}">${ach.title}</h4>
                            <p class="text-sm ${unlocked ? 'text-gray-600 dark:text-gray-300' : 'text-gray-400'}">${ach.desc}</p>
                        </div>
                        ${unlocked ? '<i class="fas fa-check text-green-500 ml-auto"></i>' : '<i class="fas fa-lock text-gray-400 ml-auto"></i>'}
                    </div>
                `;
            }).join('');
        }

        // --- UTILS ---

        function toggleTheme() {
            document.documentElement.classList.toggle('dark');
            localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');
        }

        function toggleAchievements() {
            const modal = document.getElementById('achievements-modal');
            const content = document.getElementById('modal-content');
            
            if (modal.classList.contains('hidden')) {
                modal.classList.remove('hidden');
                setTimeout(() => content.classList.remove('scale-95'), 10);
            } else {
                content.classList.add('scale-95');
                setTimeout(() => modal.classList.add('hidden'), 200);
            }
        }

        function closeAchievements(e) {
            if (e.target.id === 'achievements-modal') toggleAchievements();
        }

        function showToast(msg) {
            const toast = document.getElementById('toast');
            document.getElementById('toast-message').innerText = msg;
            toast.classList.remove('translate-y-[-150%]');
            setTimeout(() => {
                toast.classList.add('translate-y-[-150%]');
            }, 3000);
        }

        function copyResponse() {
            const text = document.getElementById('response-text').innerText;
            navigator.clipboard.writeText(text);
            showToast("Texto copiado");
        }

        function triggerConfetti() {
            // Simple emoji confetti implementation
            for(let i=0; i<30; i++) {
                const el = document.createElement('div');
                el.innerText = ['‚ú®', 'üêë', '‚≠ê', '‚òÅÔ∏è'][Math.floor(Math.random()*4)];
                el.style.position = 'fixed';
                el.style.left = Math.random() * 100 + 'vw';
                el.style.top = '-10vh';
                el.style.fontSize = (Math.random() * 20 + 10) + 'px';
                el.style.transition = 'top 2s ease-in, transform 2s linear';
                el.style.zIndex = 100;
                document.body.appendChild(el);
                
                setTimeout(() => {
                    el.style.top = '110vh';
                    el.style.transform = `rotate(${Math.random()*360}deg)`;
                }, 100);

                setTimeout(() => el.remove(), 2100);
            }
        }

        // Minimal markdown parser for bold and lists
        function marked(text) {
            if(!text) return '';
            let html = text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>') // Bold
                .replace(/\*(.*?)\*/g, '<em>$1</em>') // Italic
                .replace(/\n\n/g, '<br><br>'); // Paragraphs
            
            // List parsing (basic)
            if (html.includes('* ')) {
                const lines = html.split('<br>');
                html = lines.map(line => {
                    if (line.trim().startsWith('* ')) {
                        return `<li>${line.replace('* ', '')}</li>`;
                    }
                    return line;
                }).join('<br>');
                // Wrap lis in ul (very naive, assumes contiguous lists)
                html = html.replace(/(<li>.*<\/li>)/g, '<ul class="list-disc pl-5">$1</ul>').replace(/<\/ul><br><ul class="list-disc pl-5">/g, ''); 
            }
            return html;
        }
    </script>
</body>
</html>
